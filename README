## Drupal development toolkit based on Docker

With this toolset, you can install docker and easily fire up your dev environment.
 - drupal 7
 - SSL support
 - PHP 5.4, 5.6 (default), 7.0
 - Apache 2.2
 - one MySQL container for all projects (data saved in your local home-folder).
 - one Drupal 7 container + hostname per project
 - one Solr container for all projects
 - mailsink that collects al emails sent through sendmail (/tmp/d7-docker-mailsink on host)
 - varnish out-of-the-box (See 'CUSTOM PROJECT CONFIGURATION')
 - memcache
 - custom mounts

## Credits
Simple Drupal Docker Toolset is sponsored and supported by [Finalist B.V.](http://www.finalist.nl/)

### INSTALLATION

Clone git repository somewehere in local folder, or download archive package, and unpack.
  # git clone https://github.com/reinier-vegter/Simple-Drupal-Docker-Toolset.git ~/docker-drupal


GNU/Linux distro:
 - Install docker:
   curl -sSL https://get.docker.com/ | sh
 - Add yourself to docker group
   sudo usermod -aG docker [YOUR USER]
 - Then, logout your system and login again
 - Run bin/install.sh to symlink all needed scripts to your bin folder.
 - Give write access to yourself on hosts file
   sudo chown root:$(whoami) /etc/hosts
   sudo chmod 664 /etc/hosts

OSX
From: https://docs.docker.com/installation/mac/
 - Install toolbox from https://www.docker.com/toolbox
 - Open Docker Quickstart Terminal and close when finished

- Add your user to 'wheel' group (awesome people):
  sudo dseditgroup -o edit -a $(whoami) -t user wheel
- Give wheel-group write access to hosts file:
  sudo chmod 664 /etc/hosts
- Run bin/install.sh to symlink all needed scripts to your bin folder.

### AVAILABLE COMMANDS

        - d7-build-docker-image           : Build / rebuild the drupal 7 docker image
        - d7-start                        : start drupal 7 container from project folder
        - d7-stop                         : stop container for 'this' project
        - d7-mysql-start                  : start mysql container (triggered by d7-start)
        - d7-mysql-stop                   : stop mysql container
        - d7-solr4-start                  : start solr4 container (triggered by d7-start)
        - d7-solr4-stop                   : stop solr4 container
        - d7-status                       : shows all docker containers (running and stopped)
        - d7-stop-all                     : stop all drupal 7 containers
        - d7-cleanup                      : Cleanup (stop + remove) all drupal 7 containers.
                                            : They are disposable, and usually removed immediately
                                            : when you stop a d7 container.
        - d7-logs [num|all]               : Tail all apache logs.
                                            : Argument sets number of lines to print, before following.
                                            :   (Should be integer, or 'all')
                                            : Starts 'docker logs --tail=[num] -f [container]'
        - d7-ssh [container (optional)]   : Open shell (bash) in container. Defaults to container in current webroot folder.
        - d7-help                         : Show README


### QUICK START

To start your project, go to the project folder, and run 'd7-start'
Note that settings.php must contain the mysql-host 'mysql-docker.dev',
and that solr is reachable at solr4-docker.dev:8983/solr or localhost:8983 from each drupal container.

Building docker images is done the first time you use them ("d7-start"), and can take a while.


### CUSTOM PROJECT CONFIGURATION

Custom docker stuff per project:
Add file .d7-docker.conf to your project folder.

**Be aware that any bash code in this file is actually executed**

Example content of file:

        # Add dependency container.
        # Format: [container name]:[start-script/command]
        # CUST_DEPENDENCIES=(
        #   "docker.mysql:${mydir}/d7-mysql-start.sh"
        #   "docker.solr4:${mydir}/d7-solr4-start.sh"
        # )
        #
        # Add custom link between containers.
        # Format: [dependency container name]:[hostname in 'this' container, mapped to dependency]
        # CUST_LINK=(
        #   "docker.mysql:mysql-docker.dev"
        #   "docker.solr4:solr4-docker.dev"
        # )
        #
        # Mount extra volumes in container.
        # Format: [local folder]:[folder in container]
        # CUST_VOL="/opt/simplesamlphp:/opt/simplesamlphp1"
        #
        # Give container extra hostnames.
        # CUST_HOSTNAMES=(
        #   "dev.my-favorite-hostname.com"
        # )
        #
        # Do not check if this is actually Drupal. Usable for 'other' php apps to be ran in
        # a D7 container.
        # NO_DRUPAL_CHECK=1
        #
        # Enable Varnish cache engine
        # VARNISH_ENABLE=1
        #
        # Enable memcache daemon
        # MEMCACHED_ENABLE=1
        #
        # Set PHP version to use
        # PHP_VERSION=5.4
        # Supported versions: 5.4, 5.6, 7.0 (not all packages included yet).
        # Defaults to 5.6


### Use of XDebug

XDebug is installed in the container.
To use it with php-storm, make sure
  - to just enable the listener (no server config needed, defaults work fine)
    in order to start debugging

To use XDebug profiler, just add a 'profiler' folder in your project.
It will generate cachegrind files that you can open with KCacheGrind or any other tool.
See http://www.xdebug.org/docs/profiler
